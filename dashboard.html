<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>관리자 대시보드</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #f4f4f4; display: flex; flex-direction: column; justify-content: center; align-items: center; min-height: 100vh; margin: 0; padding: 20px; }
        .dashboard-container { background-color: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); width: 100%; max-width: 800px; text-align: center; }
        h2 { color: #333; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #f2f2f2; font-weight: bold; }
        tr:nth-child(even) { background-color: #f9f9f9; }
        .logout-btn-container { margin-top: 20px; }
        button { padding: 10px 20px; background-color: #dc3545; color: #fff; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background-color: #c82333; }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <h2>제출 파일 목록</h2>
        <table>
            <thead>
                <tr>
                    <th>문서 ID</th>
                    <th>파일명</th>
                    <th>제출일</th>
                    <th>참가자 이름</th>
                </tr>
            </thead>
            <tbody id="submissions-table-body">
                </tbody>
        </table>
        <div class="logout-btn-container">
            <button id="logout-btn">로그아웃</button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-storage.js"></script>

    <script>
        window.onload = function() {
            try {
                // 파이어베이스 설정: 여기에 당신의 실제 코드를 붙여넣으세요.
                const firebaseConfig = {
                    apiKey: "AIzaSyAC-6B0FV9UI9hFB_UzEl4iXVQDjq9ukV0",
                    authDomain: "yangonebinaievent.firebaseapp.com",
                    projectId: "yangonebinaievent",
                    storageBucket: "yangonebinaievent.firebasestorage.app",
                    messagingSenderId: "136715708338",
                    appId: "1:136715708338:web:cdf2743235b2829010a6ab"
                };
                firebase.initializeApp(firebaseConfig);
                const db = firebase.firestore();
                const storage = firebase.storage();
                const storageRef = storage.ref();

                const submissionsTableBody = document.getElementById('submissions-table-body');
                const logoutBtn = document.getElementById('logout-btn');

                db.collection('submissions').orderBy('date', 'desc').onSnapshot(async snapshot => {
                    submissionsTableBody.innerHTML = '';
                    for (const doc of snapshot.docs) {
                        const submission = doc.data();
                        const row = document.createElement('tr');
                        
                        try {
                            const fileUrl = await storageRef.child(submission.filename).getDownloadURL();
                            row.innerHTML = `
                                <td>${doc.id}</td>
                                <td><a href="${fileUrl}" target="_blank">${submission.filename}</a></td>
                                <td>${submission.date}</td>
                                <td>${submission.name}</td>
                            `;
                        } catch(error) {
                            row.innerHTML = `
                                <td>${doc.id}</td>
                                <td>${submission.filename} (오류: 파일 없음)</td>
                                <td>${submission.date}</td>
                                <td>${submission.name}</td>
                            `;
                            console.error("파일 URL 가져오기 오류:", error);
                        }
                        submissionsTableBody.appendChild(row);
                    }
                });

                logoutBtn.addEventListener('click', () => {
                    window.location.href = 'admin.html';
                });
            } catch (error) {
                console.error("파이어베이스 초기화 오류:", error);
                alert('파이어베이스 설정에 문제가 있습니다. 콘솔을 확인해주세요.');
            }
        };
    </script>
</body>
</html>